<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; touch-action: none; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>

<script>
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    scale: {
        mode: Phaser.Scale.FIT, // Auto-resizes for mobile screens
        autoCenter: Phaser.Scale.CENTER_BOTH
    },
    physics: {
        default: 'arcade',
        arcade: { gravity: { y: 0 }, debug: false }
    },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let ufo, beam, cows, farmers, score = 0, scoreText, music;
let isBeaming = false;

function preload() {
    this.load.image('sky', 'https://labs.phaser.io/assets/skies/space3.png');
    // Load your generated Synthwave MP3 here
    // this.load.audio('synthwave', 'assets/neon_horizon_drive.mp3'); 
}

function create() {
    this.add.image(400, 300, 'sky').setAlpha(0.4).setScrollFactor(0);

    // Placeholder Graphics
    const ufoGraphic = this.make.graphics().lineStyle(3, 0x00ffff).strokeCircle(20, 20, 18).strokeRect(0, 15, 40, 8);
    ufoGraphic.generateTexture('ufo', 40, 40);
    
    ufo = this.physics.add.sprite(400, 200, 'ufo');
    ufo.setCollideWorldBounds(true);

    beam = this.add.rectangle(0, 0, 60, 600, 0x00ff00, 0.2);
    beam.setVisible(false);

    cows = this.physics.add.group();
    farmers = this.physics.add.group();

    scoreText = this.add.text(20, 20, 'ABDUCTIONS: 0', { fontSize: '28px', fill: '#0ff', fontFamily: 'monospace' });

    // --- MOBILE / TOUCH CONTROLS ---
    
    // 1. Movement: UFO follows the pointer (finger or mouse)
    this.input.on('pointermove', (pointer) => {
        // Smoothly move toward finger position
        this.physics.moveToObject(ufo, pointer, 300);
        
        // Add a nice tilt based on movement direction
        if (pointer.x < ufo.x) ufo.setAngle(-15);
        else if (pointer.x > ufo.x) ufo.setAngle(15);
    });

    // 2. Beaming: Activate beam when screen is pressed
    this.input.on('pointerdown', () => { 
        isBeaming = true; 
        // Start music on first tap (mobile requirement)
        if (music && !music.isPlaying) music.play();
    });
    this.input.on('pointerup', () => { isBeaming = false; ufo.setVelocity(0); });

    // Spawning logic
    this.time.addEvent({ delay: 2500, callback: spawnTarget, callbackScope: this, loop: true });
}

function update() {
    if (isBeaming) {
        beam.setPosition(ufo.x, ufo.y + 300);
        beam.setVisible(true);
        
        // Abduction detection
        cows.children.iterate(cow => {
            if (cow && Math.abs(cow.x - ufo.x) < 30) {
                cow.y -= 5; // Pull them up!
                if (cow.y < ufo.y) {
                    cow.destroy();
                    score += 10;
                    scoreText.setText('ABDUCTIONS: ' + score);
                }
            }
        });
    } else {
        beam.setVisible(false);
    }

    // Danger: If you fly too low near a farmer (red square)
    farmers.children.iterate(f => {
        if (f && Phaser.Math.Distance.Between(ufo.x, ufo.y, f.x, f.y) < 60) {
            this.scene.restart();
            score = 0;
        }
    });
}

function spawnTarget() {
    let x = Phaser.Math.Between(50, 750);
    let type = Math.random() > 0.3 ? 'cow' : 'farmer';
    
    if (type === 'cow') {
        let cow = cows.create(x, 560, null);
        const g = this.make.graphics().fillStyle(0xffffff).fillRect(0,0,25,18);
        g.generateTexture('cow', 25, 18);
        cow.setTexture('cow');
    } else {
        let farmer = farmers.create(x, 560, null);
        const g = this.make.graphics().fillStyle(0xff0055).fillRect(0,0,20,35);
        g.generateTexture('farmer', 20, 35);
        farmer.setTexture('farmer');
    }
}
</script>

</body>
</html>
