<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBER-WARRIOR: OVERDRIVE</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; }
        canvas { display: block; image-rendering: pixelated; }
        
        #ui {
            position: absolute;
            top: 0; left: 0; width: 100%;
            padding: 20px 40px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            font-family: 'Segoe UI', 'Courier New', monospace;
            pointer-events: none;
            z-index: 10;
        }

        .stat { color: #fff; text-shadow: 0 0 15px #0ff; }
        .score-val { font-size: 54px; font-weight: 900; color: #0ff; }
        .lives-val { font-size: 48px; color: #f0f; }
        
        #weapon-bar {
            position: absolute;
            top: 100px; left: 40px;
            width: 250px; height: 15px;
            background: rgba(0,255,255,0.2);
            border: 2px solid #0ff;
            display: none;
        }
        #weapon-fill { height: 100%; width: 100%; background: #0ff; transition: width 0.1s linear; }

        #overlay {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(20,0,40,0.9) 0%, rgba(0,0,0,1) 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 20; color: #fff; text-align: center;
        }

        h1 { font-size: 90px; margin: 0; font-style: italic; color: #fff; text-shadow: 5px 5px #f0f, -5px -5px #0ff; }
        button {
            margin-top: 30px; padding: 15px 60px; font-size: 32px;
            background: #f0f; color: #fff; border: none; cursor: pointer;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        }

        #mobile-controls {
            position: absolute; bottom: 40px; width: 100%; display: none;
            justify-content: space-between; padding: 0 50px; box-sizing: border-box;
        }
        .touch-pad { width: 150px; height: 150px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 4px solid #0ff; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat"><div style="font-size: 20px;">SYSTEM SCORE</div><div id="scoreVal" class="score-val">000000</div></div>
    <div class="stat" style="text-align: right;"><div style="font-size: 20px;">HULL INTEGRITY</div><div id="livesVal" class="lives-val">███</div></div>
</div>

<div id="weapon-bar"><div id="weapon-fill"></div><div style="position:absolute; top:-25px; color:#0ff; font-weight:bold;" id="weapon-name">LASER</div></div>

<div id="overlay">
    <h1>NEON STRIKE</h1>
    <p style="letter-spacing: 8px; color: #0ff;">ADVANCED COMBAT SIMULATION</p>
    <button onclick="bootSystem()">LOAD MISSION</button>
</div>

<div id="mobile-controls">
    <div id="movePad" class="touch-pad"></div>
    <div id="firePad" class="touch-pad" style="border-color: #f0f;"></div>
</div>

<canvas id="gc"></canvas>

<script>
/** * HIGH-FIDELITY AUDIO ENGINE
 */
const audio = new (window.AudioContext || window.webkitAudioContext)();

function sfx(freq, type, duration, vol, slide = 0) {
    const o = audio.createOscillator();
    const g = audio.createGain();
    o.type = type;
    o.frequency.setValueAtTime(freq, audio.currentTime);
    if(slide) o.frequency.exponentialRampToValueAtTime(slide, audio.currentTime + duration);
    g.gain.setValueAtTime(vol, audio.currentTime);
    g.gain.linearRampToValueAtTime(0, audio.currentTime + duration);
    o.connect(g); g.connect(audio.destination);
    o.start(); o.stop(audio.currentTime + duration);
}

function explodeSfx() {
    const b = audio.createBuffer(1, audio.sampleRate * 0.4, audio.sampleRate);
    const d = b.getChannelData(0);
    for(let i=0; i<b.length; i++) d[i] = Math.random() * 2 - 1;
    const s = audio.createBufferSource(); s.buffer = b;
    const f = audio.createBiquadFilter(); f.type = 'lowpass';
    f.frequency.setValueAtTime(800, audio.currentTime);
    f.frequency.exponentialRampToValueAtTime(40, audio.currentTime + 0.3);
    const g = audio.createGain(); g.gain.setValueAtTime(0.4, audio.currentTime);
    g.gain.linearRampToValueAtTime(0, audio.currentTime + 0.3);
    s.connect(f); f.connect(g); g.connect(audio.destination);
    s.start();
}

/**
 * GAME CORE
 */
const canvas = document.getElementById('gc');
const ctx = canvas.getContext('2d');
let w, h, active = false, score = 0, lives = 3, frame = 0;
let weaponType = 'default', weaponTimer = 0;

function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
}
window.onresize = resize;
resize();

const player = { x: 100, y: h/2, w: 70, h: 35, speed: 9 };
let bullets = [], enemies = [], powerups = [], parts = [], stars = [], city = [];

// Setup parallax city
for(let i=0; i<15; i++) {
    city.push({
        x: i * (w/10), 
        w: 150 + Math.random()*200, 
        h: 200 + Math.random()*400, 
        color: i % 2 === 0 ? '#050515' : '#0a0a20',
        lights: Array.from({length: 10}, () => ({x: Math.random()*100, y: Math.random()*300, c: Math.random() > 0.5 ? '#0ff' : '#f0f'}))
    });
}
for(let i=0; i<100; i++) stars.push({x: Math.random()*w, y: Math.random()*h, s: Math.random()*2+1});

const input = {};
window.onkeydown = e => input[e.code] = true;
window.onkeyup = e => input[e.code] = false;

function shoot() {
    const now = Date.now();
    if(weaponType === 'default') {
        bullets.push({x: player.x + 60, y: player.y + 15, vx: 18, vy: 0, color: '#0ff', type: 'std'});
        sfx(600, 'square', 0.1, 0.1, 100);
    } else if(weaponType === 'spread') {
        [-0.2, 0, 0.2].forEach(angle => {
            bullets.push({x: player.x + 60, y: player.y + 15, vx: 16, vy: angle*10, color: '#f0f', type: 'std'});
        });
        sfx(400, 'sawtooth', 0.15, 0.1, 50);
    } else if(weaponType === 'hyper') {
        bullets.push({x: player.x + 60, y: player.y + 15, vx: 25, vy: 0, color: '#fff', type: 'heavy'});
        sfx(800, 'sine', 0.05, 0.1);
    }
}

function spawnEnemy() {
    const r = Math.random();
    let e = { x: w + 100, y: Math.random()*(h-100)+50, vx: -5, hp: 1, pts: 100, size: 40, type: 'scout' };
    
    if(r > 0.9) { // Goliath
        e = { ...e, hp: 8, pts: 1000, size: 90, type: 'heavy', vx: -2 };
    } else if(r > 0.7) { // Phantom
        e = { ...e, hp: 3, pts: 400, size: 50, type: 'phantom', vx: -7 };
    }
    enemies.push(e);
}

function update() {
    if(!active) return;

    if(input['ArrowUp'] || input['KeyW']) player.y -= player.speed;
    if(input['ArrowDown'] || input['KeyS']) player.y += player.speed;
    if(input['ArrowLeft'] || input['KeyA']) player.x -= player.speed;
    if(input['ArrowRight'] || input['KeyD']) player.x += player.speed;
    if(input['Space'] && frame % (weaponType === 'hyper' ? 4 : 10) === 0) shoot();

    player.y = Math.max(50, Math.min(h-50, player.y));
    player.x = Math.max(20, Math.min(w/2, player.x));

    // Powerup Logic
    if(weaponTimer > 0) {
        weaponTimer--;
        document.getElementById('weapon-bar').style.display = 'block';
        document.getElementById('weapon-fill').style.width = (weaponTimer / 1800 * 100) + '%';
        if(weaponTimer <= 0) {
            weaponType = 'default';
            document.getElementById('weapon-bar').style.display = 'none';
        }
    }

    if(frame % 1500 === 0) { // Very rare
        powerups.push({x: w, y: Math.random()*h, type: Math.random() > 0.5 ? 'spread' : 'hyper'});
    }

    if(frame % 45 === 0) spawnEnemy();

    // Collision & Movement
    bullets.forEach((b, bi) => {
        b.x += b.vx; b.y += b.vy;
        enemies.forEach((en, ei) => {
            if(b.x > en.x && b.x < en.x + en.size && b.y > en.y && b.y < en.y + en.size) {
                en.hp -= (b.type === 'heavy' ? 2 : 1);
                bullets.splice(bi, 1);
                if(en.hp <= 0) {
                    score += en.pts;
                    explodeSfx();
                    enemies.splice(ei, 1);
                    for(let i=0; i<15; i++) parts.push({x: en.x, y: en.y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, l: 20, c: '#f0f'});
                }
            }
        });
    });

    enemies.forEach((en, i) => {
        en.x += en.vx;
        if(en.type === 'phantom') en.y += Math.sin(frame*0.05)*4;
        if(Math.abs(player.x - en.x) < 40 && Math.abs(player.y - en.y) < en.size/2) {
            lives--;
            enemies.splice(i, 1);
            sfx(100, 'sawtooth', 0.5, 0.3);
            if(lives <= 0) gameOver();
        }
    });

    powerups.forEach((p, i) => {
        p.x -= 4;
        if(Math.abs(player.x - p.x) < 40 && Math.abs(player.y - p.y) < 40) {
            weaponType = p.type;
            weaponTimer = 1800; // 30 seconds at 60fps
            document.getElementById('weapon-name').innerText = p.type.toUpperCase();
            sfx(800, 'sine', 0.4, 0.2, 1200);
            powerups.splice(i, 1);
        }
    });

    document.getElementById('scoreVal').innerText = score.toString().padStart(6, '0');
    document.getElementById('livesVal').innerText = "█".repeat(lives);
    frame++;
}

function draw() {
    ctx.fillStyle = '#020208';
    ctx.fillRect(0,0,w,h);

    // City Background
    city.forEach(b => {
        b.x -= 0.5;
        if(b.x + b.w < 0) b.x = w;
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, h - b.h, b.w, b.h);
        ctx.fillStyle = '#1a1a30'; // Windows
        b.lights.forEach(l => {
            if(frame % 60 < 30) ctx.fillStyle = l.c;
            ctx.fillRect(b.x + l.x, h - b.h + l.y, 4, 4);
        });
    });

    // Stars
    ctx.fillStyle = '#fff';
    stars.forEach(s => { s.x -= s.s; if(s.x < 0) s.x = w; ctx.fillRect(s.x, s.y, s.s, s.s); });

    // Player (16-bit Detailed)
    ctx.shadowBlur = 10; ctx.shadowColor = '#0ff';
    ctx.fillStyle = '#0aa'; // Bottom wing
    ctx.fillRect(player.x, player.y + 20, 40, 10);
    ctx.fillStyle = '#0ff'; // Main hull
    ctx.fillRect(player.x + 10, player.y + 5, 55, 15);
    ctx.fillStyle = '#fff'; // Top detailing
    ctx.fillRect(player.x + 15, player.y, 30, 5);
    ctx.fillStyle = '#f0f'; // Cockpit
    ctx.fillRect(player.x + 40, player.y + 5, 15, 6);
    // Engine
    ctx.fillStyle = frame % 4 < 2 ? '#f0f' : '#fff';
    ctx.fillRect(player.x - 15, player.y + 8, 15, 8);
    ctx.shadowBlur = 0;

    // Enemies
    enemies.forEach(en => {
        ctx.shadowBlur = 5; ctx.shadowColor = '#f0f';
        if(en.type === 'heavy') {
            ctx.fillStyle = '#444'; ctx.fillRect(en.x, en.y, 90, 60);
            ctx.fillStyle = '#f0f'; ctx.fillRect(en.x + 10, en.y + 10, 70, 40);
        } else if(en.type === 'phantom') {
            ctx.globalAlpha = 0.3 + Math.abs(Math.sin(frame*0.05));
            ctx.fillStyle = '#0ff'; ctx.fillRect(en.x, en.y, 50, 20);
            ctx.globalAlpha = 1;
        } else {
            ctx.fillStyle = '#0f0'; ctx.fillRect(en.x, en.y, 30, 15);
            ctx.fillRect(en.x + 10, en.y - 5, 10, 25);
        }
        ctx.shadowBlur = 0;
    });

    // Projectiles
    bullets.forEach(b => {
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, b.y, b.type === 'heavy' ? 30 : 15, 4);
    });

    // Powerups
    powerups.forEach(p => {
        ctx.fillStyle = '#fff';
        ctx.fillRect(p.x, p.y, 30, 30);
        ctx.strokeStyle = '#0ff';
        ctx.strokeRect(p.x - 2, p.y - 2, 34, 34);
    });

    requestAnimationFrame(() => { update(); draw(); });
}

function bootSystem() {
    audio.resume();
    active = true;
    score = 0; lives = 3;
    document.getElementById('overlay').style.display = 'none';
}

function gameOver() {
    active = false;
    document.getElementById('overlay').style.display = 'flex';
    document.querySelector('h1').innerText = "LINK SEVERED";
}

draw();
</script>
</body>
</html>
