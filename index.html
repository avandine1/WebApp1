<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #050510; overflow: hidden; touch-action: none; font-family: 'Courier New', Courier, monospace; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .mobile-btn { pointer-events: auto; position: absolute; width: 60px; height: 60px; background: rgba(0, 255, 255, 0.2); border: 2px solid #0ff; border-radius: 50%; display: none; }
        @media (pointer: coarse) { .mobile-btn { display: block; } }
    </style>
</head>
<body>

<div id="ui-layer">
    <div id="btn-up" class="mobile-btn" style="bottom: 140px; left: 80px;"></div>
    <div id="btn-down" class="mobile-btn" style="bottom: 20px; left: 80px;"></div>
    <div id="btn-left" class="mobile-btn" style="bottom: 80px; left: 20px;"></div>
    <div id="btn-right" class="mobile-btn" style="bottom: 80px; left: 140px;"></div>
    <div id="btn-beam" class="mobile-btn" style="bottom: 50px; right: 40px; width: 100px; height: 100px; background: rgba(255, 0, 255, 0.3); border-color: #f0f;"></div>
</div>

<script>
const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    physics: { default: 'arcade', arcade: { gravity: { y: 0 } } },
    pixelArt: true, // Keeps pixel edges sharp
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let ufo, beam, cursors, score = 0, scoreText;
let music, sfxAbduct, sfxZap;
let moveKeys = { up: false, down: false, left: false, right: false, beam: false };

function preload() {
    // Realistic Pixel Assets (Replace with your URLs)
    this.load.image('ufo', 'ufo_pixel.png'); 
    this.load.image('cow', 'cow_pixel.png');
    this.load.image('background', 'image_3e687d.jpg'); // Your reference moon bg
    
    // SOUNDS: Place these in your /assets/ folder
    // this.load.audio('music', 'neon_horizon_drive.mp3');
    // this.load.audio('sfx_abduct', 'abduction_hum.mp3');
    // this.load.audio('sfx_zap', 'laser_hit.mp3');
}

function create() {
    // 1. Background Setup
    let bg = this.add.image(config.width/2, config.height/2, 'background').setDisplaySize(config.width, config.height).setAlpha(0.6);
    
    // 2. UFO with Neon Bloom
    ufo = this.physics.add.sprite(config.width/2, 200, 'ufo').setScale(1.5);
    ufo.setCollideWorldBounds(true);
    
    // Create a "Glow" effect under the UFO
    let glow = this.add.pointlight(ufo.x, ufo.y, 0x00ffff, 150, 0.5);
    this.events.on('update', () => { glow.setPosition(ufo.x, ufo.y); });

    // 3. Abduction Beam (Cyberpunk Gradient)
    beam = this.add.rectangle(0, 0, 80, 2000, 0x00ff00, 0.3).setVisible(false);
    
    // 4. Input Mapping (Mobile + Keyboard)
    setupControls.call(this);

    // 5. Audio Initialization
    // music = this.sound.add('music', { loop: true, volume: 0.5 });
    // sfxAbduct = this.sound.add('sfx_abduct', { volume: 0.3 });

    scoreText = this.add.text(20, 20, 'SYSTEM_SCORE: 000', { fontSize: '24px', color: '#0ff' });
}

function update() {
    const speed = 300;
    ufo.setVelocity(0);

    // Movement Logic
    if (moveKeys.left) { ufo.setVelocityX(-speed); ufo.setAngle(-10); }
    else if (moveKeys.right) { ufo.setVelocityX(speed); ufo.setAngle(10); }
    else { ufo.setAngle(0); }

    if (moveKeys.up) ufo.setVelocityY(-speed);
    if (moveKeys.down) ufo.setVelocityY(speed);

    // Beam Action
    if (moveKeys.beam) {
        beam.setVisible(true).setPosition(ufo.x, ufo.y + 1000);
        // if (!sfxAbduct.isPlaying) sfxAbduct.play();
    } else {
        beam.setVisible(false);
        // sfxAbduct.stop();
    }
}

function setupControls() {
    cursors = this.input.keyboard.createCursorKeys();
    let wasd = this.input.keyboard.addKeys('W,A,S,D');

    // Sync Keyboard to moveKeys
    this.events.on('update', () => {
        moveKeys.up = cursors.up.isDown || wasd.W.isDown;
        moveKeys.down = cursors.down.isDown || wasd.S.isDown;
        moveKeys.left = cursors.left.isDown || wasd.A.isDown;
        moveKeys.right = cursors.right.isDown || wasd.D.isDown;
        moveKeys.beam = cursors.space.isDown;
    });

    // Mobile D-Pad Listeners
    const bindBtn = (id, key) => {
        const el = document.getElementById(id);
        el.addEventListener('pointerdown', () => { moveKeys[key] = true; });
        el.addEventListener('pointerup', () => { moveKeys[key] = false; });
        el.addEventListener('pointerout', () => { moveKeys[key] = false; });
    };

    bindBtn('btn-up', 'up');
    bindBtn('btn-down', 'down');
    bindBtn('btn-left', 'left');
    bindBtn('btn-right', 'right');
    bindBtn('btn-beam', 'beam');
}
</script>
</body>
</html>
