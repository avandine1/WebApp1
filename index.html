<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Synthwave Space Attack</title>
    <style>
        :root { --neon-pink: #ff00ff; --neon-blue: #00ffff; }
        body { background: #050010; color: #fff; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; touch-action: none; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
        canvas { background: #000; border: 2px solid var(--neon-blue); box-shadow: 0 0 20px var(--neon-blue); max-width: 95vw; max-height: 70vh; image-rendering: pixelated; }

        /* Mobile Controls */
        #controls { position: absolute; bottom: 20px; width: 90%; display: flex; justify-content: space-between; pointer-events: none; }
        .btn { width: 70px; height: 70px; background: rgba(255,255,255,0.1); border: 2px solid var(--neon-pink); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; pointer-events: auto; user-select: none; -webkit-user-select: none; }
        .btn:active { background: var(--neon-pink); color: #000; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; text-align: center; }
        .hidden { display: none; }
        button#start-btn { background: var(--neon-blue); color: #000; border: none; padding: 20px 40px; font-size: 1.5rem; font-weight: bold; cursor: pointer; box-shadow: 0 0 15px var(--neon-blue); }
        .stats { position: absolute; top: 20px; font-size: 1.2rem; color: var(--neon-pink); }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="stats">SCORE: <span id="scoreVal">0</span></div>
        <canvas id="gameCanvas"></canvas>

        <div id="menuScreen" class="overlay">
            <h1 style="color: var(--neon-pink); font-size: 3rem; text-shadow: 0 0 10px var(--neon-pink);">SYNTH ATTACK</h1>
            <button id="start-btn" onclick="startGame()">START MISSION</button>
        </div>

        <div id="endScreen" class="overlay hidden">
            <h1 id="endTitle" style="font-size: 2.5rem;">GAME OVER</h1>
            <button onclick="startGame()" style="background:var(--neon-pink); padding: 15px 30px; border:none; font-weight:bold;">REBOOT</button>
        </div>

        <div id="controls">
            <div style="display:flex; gap: 20px;">
                <div class="btn" id="btnLeft">←</div>
                <div class="btn" id="btnRight">→</div>
            </div>
            <div class="btn" id="btnFire" style="border-color: var(--neon-blue);">FIRE</div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('scoreVal');
    
    // Set internal resolution
    canvas.width = 600; canvas.height = 450;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- SYNTHWAVE AUDIO ENGINE ---
    function playSynth(freq, vol, type, duration, sweep) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        if(sweep) osc.frequency.exponentialRampToValueAtTime(sweep, audioCtx.currentTime + duration);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    function playDeepExplosion() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(100, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(20, audioCtx.currentTime + 0.4);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.4);
    }

    let musicTick = 0;
    function synthMusicLoop() {
        if (!gameActive) return;
        // Driving Kick Drum
        if (musicTick % 16 === 0) playSynth(60, 0.1, 'sine', 0.1, 30);
        // Pulsing Bassline
        if (musicTick % 16 === 8) playSynth(55, 0.05, 'sawtooth', 0.15);
        // Arpeggiated Lead
        if (musicTick % 8 === 0) {
            const melody = [220, 261, 329, 392];
            playSynth(melody[(musicTick/8)%4], 0.02, 'triangle', 0.2);
        }
        musicTick++;
    }

    // --- GAME ENGINE ---
    let score, gameActive, player, enemies, pBullets, eBullets, particles, stars, enemyDir, enemySpeed, shake;
    const keys = {};

    function startGame() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        score = 0; gameActive = true; enemyDir = 1; enemySpeed = 1.2; shake = 0;
        pBullets = []; eBullets = []; enemies = []; particles = [];
        player = { x: 280, y: 380, w: 40, h: 15 };
        stars = Array.from({length: 50}, () => ({x: Math.random()*600, y: Math.random()*450, s: Math.random()*2+1}));
        
        for(let i=0; i<8; i++) for(let j=0; j<3; j++) enemies.push({x: i*65+45, y: j*40+60, w: 30, h: 20, alive: true});
        
        document.getElementById('menuScreen').classList.add('hidden');
        document.getElementById('endScreen').classList.add('hidden');
        loop();
    }

    // Input Handling
    window.addEventListener('keydown', e => { 
        if(e.code === 'Space' && gameActive) shoot();
        keys[e.code] = true; 
    });
    window.addEventListener('keyup', e => keys[e.code] = false);

    // Mobile Input
    const btnLeft = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');
    const btnFire = document.getElementById('btnFire');

    btnLeft.ontouchstart = () => keys['ArrowLeft'] = true;
    btnLeft.ontouchend = () => keys['ArrowLeft'] = false;
    btnRight.ontouchstart = () => keys['ArrowRight'] = true;
    btnRight.ontouchend = () => keys['ArrowRight'] = false;
    btnFire.ontouchstart = (e) => { e.preventDefault(); shoot(); };

    function shoot() {
        if(pBullets.length < 4) {
            pBullets.push({ x: player.x+18, y: player.y });
            playSynth(800, 0.1, 'square', 0.1, 200);
        }
    }

    function loop() {
        if (!gameActive) return;
        update();
        draw();
        synthMusicLoop();
        requestAnimationFrame(loop);
    }

    function update() {
        if (keys['ArrowLeft'] && player.x > 0) player.x -= 5;
        if (keys['ArrowRight'] && player.x < 560) player.x += 5;

        // Enemy Movement
        let edge = false;
        enemies.forEach(e => {
            if(!e.alive) return;
            e.x += enemyDir * enemySpeed;
            if(e.x < 10 || e.x > 560) edge = true;
        });
        if(edge) { enemyDir *= -1; enemies.forEach(e => e.y += 15); enemySpeed += 0.05; }

        // Logic for Bullets & Collisions
        pBullets = pBullets.filter(b => {
            b.y -= 10;
            let hit = false;
            enemies.forEach(e => {
                if(e.alive && b.x > e.x && b.x < e.x+30 && b.y > e.y && b.y < e.y+20) {
                    e.alive = false; hit = true; score += 10; scoreVal.innerText = score;
                    playDeepExplosion();
                    shake = 10;
                    for(let i=0; i<10; i++) particles.push({x: e.x+15, y: e.y+10, vx: Math.random()*4-2, vy: Math.random()*4-2, l: 1});
                }
            });
            return b.y > 0 && !hit;
        });

        // Stars & Shake
        stars.forEach(s => { s.y += s.s; if(s.y > 450) s.y = 0; });
        particles.forEach(p => { p.x += p.vx; p.y += p.vy; p.l -= 0.03; });
        if(shake > 0) shake *= 0.9;
    }

    function draw() {
        ctx.save();
        if(shake > 1) ctx.translate(Math.random()*shake-shake/2, Math.random()*shake-shake/2);
        
        ctx.fillStyle = '#050010'; ctx.fillRect(0, 0, 600, 450);
        
        // Neon Grid Look
        ctx.strokeStyle = '#200040';
        for(let i=0; i<600; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,450); ctx.stroke(); }

        ctx.fillStyle = '#fff'; stars.forEach(s => ctx.fillRect(s.x, s.y, s.s, s.s));
        ctx.fillStyle = '#0f0'; ctx.fillRect(player.x, player.y+5, 40, 10); ctx.fillRect(player.x+15, player.y, 10, 5);
        
        enemies.forEach(e => {
            if(e.alive) {
                ctx.fillStyle = '#ff00ff';
                ctx.fillRect(e.x, e.y, 30, 15);
                ctx.fillStyle = '#00ffff'; ctx.fillRect(e.x+10, e.y+5, 10, 5);
            }
        });

        ctx.fillStyle = '#0ff'; pBullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));
        particles.forEach(p => { ctx.fillStyle = `rgba(255,0,255,${p.l})`; ctx.fillRect(p.x, p.y, 3, 3); });
        ctx.restore();
    }
</script>
</body>
</html>
