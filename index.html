<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBER-STRIKE 198X</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #050510;
            color: #ff00ff;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            touch-action: none;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            image-rendering: pixelated;
            background: #0a0a1a;
            max-width: 100%;
            max-height: 100%;
            box-shadow: 0 0 20px #ff00ff55;
        }
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            text-shadow: 2px 2px #00ffff;
        }
        #menu {
            position: absolute;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border: 2px solid #ff00ff;
            z-index: 10;
        }
        button {
            background: #ff00ff;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
            font-family: inherit;
        }
        /* Mobile Controls */
        #controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: none;
            justify-content: space-between;
            padding: 0 30px;
            box-sizing: border-box;
            pointer-events: none;
        }
        .touch-btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #00ffff;
            border-radius: 50%;
            pointer-events: auto;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-layer">
        <div id="score">SCORE: 00000</div>
        <div id="health">HP: [|||]</div>
    </div>

    <div id="menu">
        <h1>CYBER-STRIKE 198X</h1>
        <p>PILOT THE NEON FIGHTER</p>
        <button onclick="startGame()">START MISSION</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <div id="joystick" class="touch-btn"></div>
        <div id="fire" class="touch-btn" style="background: rgba(255,0,255,0.3)"></div>
    </div>
</div>

<script>
/** * AUDIO ENGINE (Procedural Synthwave & SFX)
 */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSound(freq, type, duration, volume = 0.1) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + duration);
    gain.gain.setValueAtTime(volume, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
}

function startMusic() {
    const bpm = 120;
    const noteTime = 60 / bpm / 2;
    let step = 0;
    const bass = [40, 40, 40, 40, 30, 30, 35, 35];
    
    setInterval(() => {
        // Kick & Bass
        playSound(bass[step % bass.length], 'square', 0.2, 0.15);
        if (step % 4 === 0) playSound(60, 'triangle', 0.1, 0.1);
        
        // Lead melody (very basic)
        if (step % 8 === 0) {
            const melody = [220, 246, 261, 329];
            playSound(melody[Math.floor(Math.random()*melody.length)], 'sawtooth', 0.4, 0.05);
        }
        step++;
    }, noteTime * 1000);
}

/**
 * GAME ENGINE
 */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 450;

let gameActive = false;
let score = 0;
let health = 3;
let frame = 0;

const player = {
    x: 50, y: 225, w: 40, h: 20,
    speed: 5,
    dy: 0, dx: 0
};

let bullets = [];
let enemies = [];
let particles = [];
let stars = Array.from({length: 100}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    s: Math.random() * 2 + 1
}));

const keys = {};
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

// Touch support
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
if(isMobile) document.getElementById('controls').style.display = 'flex';

let touch = { active: false, x: 0, y: 0 };
canvas.addEventListener('touchstart', (e) => { touch.active = true; });
document.getElementById('fire').addEventListener('touchstart', (e) => {
    e.preventDefault();
    shoot();
});

function shoot() {
    if(!gameActive) return;
    bullets.push({x: player.x + player.w, y: player.y + player.h/2, speed: 8});
    playSound(440, 'sawtooth', 0.1);
}

function createExplosion(x, y, color) {
    for(let i=0; i<10; i++) {
        particles.push({
            x, y, 
            dx: (Math.random()-0.5)*10, 
            dy: (Math.random()-0.5)*10, 
            life: 20,
            color
        });
    }
    playSound(100, 'square', 0.3, 0.2);
}

function update() {
    if (!gameActive) return;

    // Movement
    if (keys['ArrowUp']) player.y -= player.speed;
    if (keys['ArrowDown']) player.y += player.speed;
    if (keys['ArrowLeft']) player.x -= player.speed;
    if (keys['ArrowRight']) player.x += player.speed;
    if (keys['Space'] && frame % 10 === 0) shoot();

    // Bounds
    player.y = Math.max(0, Math.min(canvas.height - player.h, player.y));
    player.x = Math.max(0, Math.min(canvas.width/2, player.x));

    // Stars Parallax
    stars.forEach(s => {
        s.x -= s.s;
        if (s.x < 0) s.x = canvas.width;
    });

    // Bullets
    bullets.forEach((b, i) => {
        b.x += b.speed;
        if (b.x > canvas.width) bullets.splice(i, 1);
    });

    // Enemies
    if (frame % 60 === 0) {
        enemies.push({
            x: canvas.width,
            y: Math.random() * (canvas.height - 30),
            w: 30, h: 20,
            type: Math.random() > 0.7 ? 'interceptor' : 'scout',
            hp: 1,
            phase: Math.random() * 10
        });
    }

    enemies.forEach((en, i) => {
        en.x -= (en.type === 'interceptor' ? 5 : 3);
        en.y += Math.sin(frame * 0.05 + en.phase) * 2; // Wavy motion

        // Collision with bullets
        bullets.forEach((b, bi) => {
            if (b.x > en.x && b.x < en.x + en.w && b.y > en.y && b.y < en.y + en.h) {
                createExplosion(en.x, en.y, '#00ffff');
                enemies.splice(i, 1);
                bullets.splice(bi, 1);
                score += 100;
            }
        });

        // Collision with player
        if (player.x < en.x + en.w && player.x + player.w > en.x && player.y < en.y + en.h && player.y + player.h > en.y) {
            health--;
            createExplosion(player.x, player.y, '#ff00ff');
            enemies.splice(i, 1);
            if (health <= 0) gameOver();
        }

        if (en.x < -40) enemies.splice(i, 1);
    });

    particles.forEach((p, i) => {
        p.x += p.dx; p.y += p.dy; p.life--;
        if (p.life <= 0) particles.splice(i, 1);
    });

    document.getElementById('score').innerText = `SCORE: ${score.toString().padStart(5, '0')}`;
    document.getElementById('health').innerText = `HP: ${'[' + '|'.repeat(health) + ' '.repeat(3-health) + ']'}`;
    
    frame++;
}

function draw() {
    ctx.fillStyle = '#0a0a1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Stars
    ctx.fillStyle = '#fff';
    stars.forEach(s => ctx.fillRect(s.x, s.y, s.s, s.s));

    // Player (16-bit style)
    ctx.fillStyle = '#00ffff';
    ctx.fillRect(player.x, player.y + 5, player.w, 10);
    ctx.fillStyle = '#ff00ff';
    ctx.fillRect(player.x + 5, player.y, 15, 20);
    ctx.fillStyle = '#fff'; // Engine glow
    if (frame % 4 < 2) ctx.fillRect(player.x - 10, player.y + 7, 10, 6);

    // Bullets
    ctx.fillStyle = '#00ffff';
    bullets.forEach(b => ctx.fillRect(b.x, b.y, 10, 4));

    // Enemies (Retro UFOs)
    enemies.forEach(en => {
        ctx.fillStyle = en.type === 'interceptor' ? '#ff3300' : '#33ff33';
        ctx.fillRect(en.x + 5, en.y, 20, 10);
        ctx.fillRect(en.x, en.y + 5, 30, 5);
        // Cockpit
        ctx.fillStyle = '#fff';
        ctx.fillRect(en.x + 12, en.y + 2, 6, 4);
    });

    // Particles
    particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 3, 3);
    });

    requestAnimationFrame(() => {
        update();
        draw();
    });
}

function startGame() {
    audioCtx.resume();
    startMusic();
    gameActive = true;
    score = 0;
    health = 3;
    enemies = [];
    document.getElementById('menu').style.display = 'none';
}

function gameOver() {
    gameActive = false;
    document.getElementById('menu').style.display = 'block';
    document.querySelector('#menu h1').innerText = "GAME OVER";
}

draw();
</script>
</body>
</html>
